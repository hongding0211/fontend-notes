# State

### æŠŠ states çœ‹åšä¸€æ¬¡å¿«ç…§

å¯ä»¥æŠŠ states çœ‹åšä¸€æ¬¡å¿«ç…§ã€‚ä¸€æ¬¡ render å°±æ˜¯æ ¹æ® states è®¡ç®—å‡ºäº†ä¸€ä¸ªç»“æœï¼ˆå¿«ç…§ï¼‰ã€‚

å½“ React åœ¨ render ä¸€ä¸ªç»„ä»¶æ—¶ï¼Œä»–é€šè¿‡è°ƒç”¨ç»„ä»¶å‡½æ•°ï¼Œå¯ä»¥è¿”å›ä¸€ä¸² JSX å†…å®¹ã€‚

è¿™ä¸ª JSX å†…å®¹å°±ç›¸å½“äºä¸€ä¸ªå¿«ç…§ã€‚é‡Œé¢ä¿ç•™äº†å½“ä¸‹çš„ propsï¼Œäº‹ä»¶å›è°ƒï¼Œæœ¬åœ°å˜é‡ç­‰ã€‚è¿™äº›éƒ½æ˜¯æ ¹æ® states è®¡ç®—è€Œæ¥çš„ã€‚

#### å½“ re-render æ—¶ï¼š

1. è°ƒç”¨ç»„ä»¶å‡½æ•°
2. è¿”å›æ–°çš„ JSX å¿«ç…§
3. Commit to Dom

![image-20220519103645849](../../.gitbook/assets/image-20220519103645849.png)

#### ä¸€æ¬¡ snapshot ç»‘å®šäº† state å’Œå›è°ƒå‡½æ•°

ä¸€æ¬¡ render è¿”å›çš„ JSX ä¸æ˜¯å®Œå…¨é™æ€çš„ï¼å®ƒè¿˜å¯ä»¥åŒ…æ‹¬å„ç§å›è°ƒå‡½æ•°ï¼Œä»è€Œå®ç°å„ç§äº¤äº’åŠŸèƒ½ã€‚

æ¯”å¦‚ä½ å¯ä»¥é€šè¿‡ `onClick` å±æ€§æ¥è§¦å‘ä¸€æ¬¡å›è°ƒï¼Œåœ¨å›è°ƒä¸­è°ƒç”¨äº† `console.log()`æ¥æŸ¥çœ‹å½“å‰å¿«ç…§ä¸­çš„æŸä¸€ä¸ª stateã€‚

**å‚è€ƒä¸‹é¢è¿™ä¸ªä¾‹å­æ›´å¥½çš„æ¥ç†è§£è¿™ä¸€æ¦‚å¿µï¼š**

```jsx
function Foo() {
    const [count, setCount] = useState(0)

    function handleClick() {
        setCount(count + 1)	// ä¼šè§¦å‘ä¸‹ä¸€æ¬¡ renderï¼Œç”Ÿæˆæ–°çš„ snapshot
        console.log(count)  // è¾“å‡ºçš„ä»ç„¶æ˜¯å½“å‰ snapshot å†…çš„ state å†…å®¹
    }

    return (
        <>
            <h3>Current count: {count}</h3>    
            <button onClick={handleClick}>Add Count</button>
        </>
    )
}
```

![iShot2022-05-19\_11.03.48](../../.gitbook/assets/iShot2022-05-19\_11.03.48.gif)

> ğŸ”¹ ä¸€æ¬¡ JSX å°±æ˜¯ä¸€ä¸ªå¿«ç…§ï¼Œä»–ä¿å­˜äº†å½“å‰çš„ state å’Œå›è°ƒå‡½æ•°ã€‚
>
> å› æ­¤å½“ä½ è°ƒç”¨è¿™ä¸ªå¿«ç…§é‡Œçš„å›è°ƒå‡½æ•°å» `console.log()` ä¸€ä¸ª stateï¼Œé‚£è¿™ä¸ª state å·²ç»æ˜¯**è¢«å°å­˜çš„äº†çš„**ã€‚
>
> å³ä¾¿ä½ ä½¿ç”¨äº† `setState()`ï¼Œé‚£ä»–ä¹Ÿåªä¸è¿‡ä¼šè§¦å‘ä¸€ä¸ªæ–°çš„ renderï¼Œè€Œè¿™ä¸€æ¬¡çš„å¿«ç…§é‡Œé¢çš„å›è°ƒå‡½æ•°ï¼Œè‡ªç„¶æ‹¿ä¸åˆ°æ–°çš„ snapshotã€‚

#### state æ˜¯æœ‰è®°å¿†æ€§çš„

å’Œåœ¨å‡½æ•°ä¸­çš„æ™®é€šå˜é‡ä¸åŒï¼Œstate **å¹¶ä¸ä¼šåœ¨å‡½æ•°æ‰§è¡Œå®Œæ¯•åå°±è¢«é‡Šæ”¾æ‰**ã€‚

state å¹¶ä¸ä¿å­˜åœ¨å‡½æ•°å†…éƒ¨ï¼Œè€Œæ˜¯åœ¨å‡½æ•°çš„å¤–éƒ¨ï¼Œè¢«ç»Ÿä¸€ç®¡ç†ã€‚

#### state åªä¼šåœ¨ä¸‹ä¸€æ¬¡ render æ—¶æ”¹å˜

è¿™ä¹Ÿå°±è§£é‡Šäº†ä¸ºä»€ä¹ˆè°ƒç”¨ä¸‰æ¬¡ `setCount(count + 1)` å®é™…ä¸Šçš„ count å¹¶ä¸ä¼š +3ï¼Œè€Œæ˜¯åªä¼š +1ã€‚

å› ä¸ºå½“ä½ è§¦å‘ä¸€æ¬¡ setCount()ï¼Œå½“å‰çš„ count å¹¶ä¸ä¼šå˜åŒ–ï¼Œä»–æ°¸è¿œéƒ½æ˜¯ 0 ã€‚

### é˜Ÿåˆ—ä¸€ç³»åˆ— stateæ›´æ–°

æ›´æ”¹ state ä¼šé˜Ÿåˆ—ä¸€æ¬¡ render æ“ä½œã€‚ä½†æ˜¯æœ‰æ—¶å€™ï¼Œä½ æƒ³åœ¨ä¸€æ¬¡ render ä¸­ï¼Œæ“ä½œå¤šæ¬¡æ›´æ–°æ“ä½œã€‚

äº‹å®ä¸Šï¼ŒReact ä¼šåœ¨æ‰§è¡Œå®Œæ‰€æœ‰å›è°ƒå‡½æ•°åæ‰ä¼šæ‰§è¡Œ re-render æ“ä½œã€‚

æ¯”å¦‚ï¼Œå¦‚æœæœ‰å¤šä¸ª setState() æ“ä½œï¼ŒReact ä¼šå°†å®ƒä»¬æ”¾å…¥åˆ°ä¸€ä¸ªé˜Ÿåˆ—ä¸­ã€‚ç›´åˆ°æ‰€æœ‰ setState() éƒ½è¢«æ¨å…¥é˜Ÿåˆ—åï¼Œæ‰ä¼šæ‰§è¡Œ re-renderã€‚åœ¨æ‰§è¡Œ re-render æ—¶ï¼Œåœ¨ä»é˜Ÿåˆ—ä¸­è¯»å…¥è¿™äº›æ“ä½œï¼Œç„¶åè®¡ç®—å‡ºæœ€åçš„ state å€¼ã€‚

![image-20220508175542896](../../.gitbook/assets/image-20220508175542896.png)

æ¢å¥è¯è¯´ï¼Œåœ¨æ²¡æœ‰æ‰§è¡Œå®Œæ‰€æœ‰å›è°ƒæ“ä½œåï¼ŒUI å¹¶ä¸ä¼šå‘ç”Ÿæ›´æ–°ã€‚

ä¸è¿‡ï¼Œä¸€äº›ä¸»åŠ¨å›è°ƒï¼Œæ¯”å¦‚ `onClick` å›è°ƒï¼ŒReact ä¸ä¼šä¹Ÿç­‰ä»–æ‰§è¡Œäº†ï¼Œæ‰ä¼šæ›´æ–° UIã€‚è¿™ä¹Ÿå¾ˆåˆç†ï¼Œå°±ç®—ä½ æ²¡æœ‰ç‚¹å‡»æŒ‰é’®è§¦å‘ `onClick` å›è°ƒï¼Œä¹Ÿä¸èƒ½å½±å“ UI çš„æ­£å¸¸æ›´æ–°ã€‚

#### setState() é˜Ÿåˆ—

æ‰€æœ‰çš„ setState() æ“ä½œï¼Œä¸ç®¡ä½ ä¼ å…¥çš„æ˜¯ä¸€ä¸ª `value` è¿˜æ˜¯ `function` ï¼Œ**éƒ½ä¼šè¢«æ¨å…¥åˆ°ä¸€ä¸ªé˜Ÿåˆ—ä¸­**ã€‚

ç›´åˆ°æ‰€æœ‰ setState() æ“ä½œå…¨éƒ¨å…¥é˜Ÿï¼ŒReact ä¼šè§¦å‘ä¸‹ä¸€æ¬¡ re-renderã€‚ç„¶åï¼Œæ ¹æ®å…¥é˜Ÿçš„é¡ºåºï¼Œä¾æ¬¡æ‰§è¡Œã€‚

å¯¹äº value å’Œ updater functionï¼Œå¤„ç†çš„æ–¹æ³•æ˜¯ä¸åŒçš„ï¼š

* å¦‚æœé˜Ÿåˆ—ä¸­è¯»åˆ° `setState(value)`ï¼Œ**é‚£ä¹ˆç›´æ¥è¦†ç›– state**ï¼Œä¸éœ€è¦ç®¡ä¹‹å‰çš„æ˜¯ä»€ä¹ˆã€‚**å› ä¸ºè¿™ä¸ª value æ˜¯ç¡®è®¤çš„**ã€‚
* å¦‚æœé˜Ÿåˆ—ä¸­è¯»åˆ° `setState(n => n + 1)`ï¼Œ**é‚£ä¹ˆä¼šæ ¹æ®ä¸Šä¸€ä¸ª state è®¡ç®—å‡ºæ–°çš„ state**ã€‚

æŒ‰ç…§ä¸Šé¢çš„æ³•åˆ™ï¼Œå³å¯ä»¥è®¡ç®—å‡ºæœ€ç»ˆçš„ state å€¼ï¼šæ¯”å¦‚ï¼š

```jsx
// init: 0
setNumber(n => n + 1)	// 1
setState(10)			// 10
setNumber(n => n + 1)	// 11
setState(20)			// 20
```

æœ€ç»ˆçš„ state å€¼å°±æ˜¯ 20ï¼ŒReact ä¼šæŠŠ 20 æ›´æ–°åˆ° UI ä¸Šå»ã€‚
